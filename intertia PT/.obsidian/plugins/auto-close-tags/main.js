/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var I=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var y=(a,l)=>{for(var e in l)I(a,e,{get:l[e],enumerable:!0})},B=(a,l,e,t)=>{if(l&&typeof l=="object"||typeof l=="function")for(let s of S(l))!E.call(a,s)&&s!==e&&I(a,s,{get:()=>l[s],enumerable:!(t=v(l,s))||t.enumerable});return a};var L=a=>B(I({},"__esModule",{value:!0}),a);var M={};y(M,{default:()=>w});module.exports=L(M);var g=require("obsidian"),D={excludedTags:"",cursorPosition:"between",ignoreInCodeBlocks:!1,ignoreInlineCode:!0},w=class extends g.Plugin{constructor(){super(...arguments);this.allowAutoClose=!1;this.lastProcessedPosition=null}async onload(){await this.loadSettings(),this.registerDomEvent(document,"paste",()=>{this.allowAutoClose=!0}),this.registerDomEvent(document,"keydown",e=>{e.key===">"&&(this.allowAutoClose=!0)}),this.registerEvent(this.app.workspace.on("editor-change",e=>{setTimeout(()=>{this.handleTyping(e)},10)})),this.addCommand({id:"close-last-tag",name:"Close last unclosed tag",hotkeys:[],editorCallback:e=>{this.insertClosingTag(e)}}),this.addSettingTab(new k(this.app,this))}handleTyping(e){let t=e.getCursor(),s=e.getLine(t.line);if(this.lastProcessedPosition&&this.lastProcessedPosition.line===t.line&&this.lastProcessedPosition.ch===t.ch||!this.allowAutoClose||(this.allowAutoClose=!1,t.ch===0||s[t.ch-1]!==">"))return;let i=s.slice(0,t.ch),n=i.match(/<([a-zA-Z][\w\-]*)\s*([^>]*)>$/);if(!n||i.endsWith("/>")||i.endsWith("</"))return;let h=n[1],c=n[0];if(this.isSelfClosing(c)||this.settings.excludedTags.split(",").map(r=>r.trim().toLowerCase()).filter(r=>r.length>0).includes(h.toLowerCase())||this.settings.ignoreInCodeBlocks&&this.isInCodeBlock(e,t.line)||this.settings.ignoreInlineCode&&this.isInInlineCode(s,t.ch))return;let p=`</${h}>`,u={line:t.line,ch:t.ch};this.lastProcessedPosition={line:t.line,ch:t.ch},e.replaceRange(p,u),this.settings.cursorPosition==="between"?e.setCursor({line:t.line,ch:t.ch}):e.setCursor({line:t.line,ch:t.ch+p.length}),setTimeout(()=>{this.lastProcessedPosition=null},100)}hasMatchingClosingTag(e,t,s,i){let h=e.getValue().split(`
`),c=1;for(let C=s;C<h.length;C++){let p=h[C],u=C===s?i:0,r=p.slice(u),m=[...r.matchAll(new RegExp(`<${t}(?:\\s[^>]*)?>`,"gi"))];c+=m.length;let o=[...r.matchAll(new RegExp(`</${t}>`,"gi"))];if(c-=o.length,c<=0)return!0}return!1}insertClosingTag(e){var r,m;let s=e.getValue().split(`
`),i=this.settings.excludedTags.split(",").map(o=>o.trim().toLowerCase()).filter(o=>o.length>0),n=[],h=[],c=!1;for(let o=0;o<s.length;o++){let d=s[o];if(d.trim().startsWith("```")){c=!c;continue}if(this.settings.ignoreInCodeBlocks&&c)continue;let b=[...d.matchAll(/<([a-zA-Z][\w\-]*)\s*([^>]*?)>/g)];for(let f of b){let T=f[0],x=f[1].toLowerCase(),P=(r=f.index)!=null?r:0;i.includes(x)||this.isSelfClosing(T)||this.settings.ignoreInlineCode&&this.isInInlineCode(d,P)||n.push({tag:x,line:o})}let A=[...d.matchAll(/<\/([a-zA-Z][\w\-]*)>/g)];for(let f of A){let T=(m=f.index)!=null?m:0;this.settings.ignoreInlineCode&&this.isInInlineCode(d,T)||h.push(f[1].toLowerCase())}}for(let o of h){let d=n.findLastIndex(b=>b.tag===o);d!==-1&&n.splice(d,1)}if(n.length===0)return;let p=`</${n[n.length-1].tag}>`,u=e.getCursor();e.replaceRange(p,u),this.settings.cursorPosition==="after"?e.setCursor({line:u.line,ch:u.ch+p.length}):e.setCursor(u)}isSelfClosing(e){var i,n;if(/\/\s*>$/.test(e))return!0;let t=["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr"],s=(n=(i=e.match(/<([a-zA-Z][\w\-]*)/))==null?void 0:i[1])==null?void 0:n.toLowerCase();return s?t.includes(s):!1}isInCodeBlock(e,t){let s=!1;for(let i=0;i<=t;i++){let n=e.getLine(i);n&&n.trim().startsWith("```")&&(s=!s)}return s}isInInlineCode(e,t){return(e.slice(0,t).match(/`/g)||[]).length%2===1}async loadSettings(){this.settings=Object.assign({},D,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},k=class extends g.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new g.Setting(e).setName("Excluded tags").setDesc("Comma-separated list of tags that should not be auto-closed (e.g., div, span, i).").addText(t=>t.setPlaceholder("e.g., div, span, i").setValue(this.plugin.settings.excludedTags).onChange(async s=>{this.plugin.settings.excludedTags=s,await this.plugin.saveSettings()})),new g.Setting(e).setName("Cursor position after auto-close").setDesc("Where to place the cursor after auto-closing a tag.").addDropdown(t=>t.addOption("between","Between tags").addOption("after","After closing tag").setValue(this.plugin.settings.cursorPosition).onChange(async s=>{this.plugin.settings.cursorPosition=s,await this.plugin.saveSettings()})),new g.Setting(e).setName("Ignore fenced code blocks").setDesc("Avoid auto-closing tags inside Markdown code blocks (``` blocks).").addToggle(t=>t.setValue(this.plugin.settings.ignoreInCodeBlocks).onChange(async s=>{this.plugin.settings.ignoreInCodeBlocks=s,await this.plugin.saveSettings()})),new g.Setting(e).setName("Ignore inline code").setDesc("Avoid auto-closing tags inside inline code spans (e.g., `<div>`).").addToggle(t=>t.setValue(this.plugin.settings.ignoreInlineCode).onChange(async s=>{this.plugin.settings.ignoreInlineCode=s,await this.plugin.saveSettings()}))}};

/* nosourcemap */